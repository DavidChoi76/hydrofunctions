# This file was autogenerated and will overwrite each time you run travis_pypi_setup.py
language: python
python:
  - "3.4"
  - "3.5"
  - "3.6"

install:
  # Travis has pre-installed numpy and scipy for Python 3.5 & 3.6, but not 3.4
  # the following lines allow older Python & pip versions to use the binary
  # wheels for numpy and scipy.  See: 
  #      https://github.com/travis-ci/travis-ci/issues/2650#issuecomment-252285413
  #      https://github.com/travis-ci/travis-ci/issues/2650#issuecomment-266721196
  
  # An alternative solution is to cache my builds: https://docs.travis-ci.com/user/caching/
  
  # Question: Do these two lines slow down the runs for Python 3.5 & 3.6?
  #     It takes about 1 min 10 seconds to run Python 3.5 & 3.6 tests without adding these two pip install lines.
  #     Pip uses wheel binaries already during the Python 3.5 & 3.6 runs.
  
  - pip install --upgrade pip setuptools wheel
  - pip install --only-binary=numpy,scipy,pandas,Ipython numpy scipy pandas ipython

  # Install codecov so I can use it (and coverage.py) to run setup.py
  # However, keep codecov in setup.py so that it gets installed for local usage too.
  - pip install codecov

script: 
  # consider using pytest: is it faster? (it's the pandas build that takes so long, not unittest)
  # - python setup.py test
  # add coverage
  - if [[ $TRAVIS_PYTHON_VERSION == 3.6 ]]; then export RUN_COVERAGE=1; fi
  - if [[ $TRAVIS_PYTHON_VERSION == 3.6 ]]; then coverage run --branch --source hydrofunctions setup.py test; fi
  - if [[ $TRAVIS_PYTHON_VERSION != 3.6 ]]; then python setup.py test; fi

after_success:
  # Only run codecov if we collected stats.
  - if [[ "$RUN_COVERAGE" == 1 ]]; then codecov; fi

deploy:
  distributions: sdist bdist_wheel
  provider: pypi
  password:
    secure: !!binary |
      ZUxHNEc4eTBmVWdBR2pwS09MY0xJazF3UWxYS29Wd3NnRS9uTnNJTW5KQ0lvM1UyOEpSUkZUeUlG
      OTJzWG9uYmpNSnpRRCtUVGUyVURxeGJzaUZNN3R5MFdpcXFNQ1MvZjk2M1M0YmMwT0R1R21hQzg4
      UWMvblpIZVJIWjl4bW1NNjA2N3Fsb3A3a2tLeGZiZ0tjczhOdlIwNEREOElXdktOMHlvbkRkTDli
      MkJyU2RIM3RCckgyL3ZVUXpLWmtoMnVhcU1jN3VPWHpZMllPc0NWaE11c3ZvbFlBMTNodG8rWlNB
      NkZrcFdSTll6UXF4azloOVQ0NWdMUFlSNXNZd2ZQb1JaVThCMXNqMjRTRG5NMCtsdlpqK0N1d0FU
      WThJSG4xc0ZRbkJpMzBaRVhDWFVrZzk5Uk5Wd3pBVHVjMXRheFM5L2FOeS84TXpabEdTMkVoUmlF
      RGtuQmR0Qi9FNVhCVEVISWRvNVFPWkxZWnNWM1BlZTFjYmVwVnNXWTZMT21kYlREQS82UDdmSGMv
      dzEvcXR1bVBqQjFDTE9JMjgyN2RLV3g4VmhkNm5KTEQyZGpENkhiTFY4aE82SUZ0QW1MUDdBdXhO
      bWJzVGlWYkNHVElOZzl4ZkEvSU5zLzRRazdJTGlpUTg3bEFRZm5YU2RnbWJ0blN6cE1KQzEyYjNx
      S1BTYkpjOFFkNm5WZXdtNVNqTEU2TXBTVW00QzJUMlEwdnJkdkE4aUpjMHFua2NoOEpLaXlWMzNN
      RWFHYWZVbUQrajhuN2E3U0xOSUtodzZJMURwNzNWdklWVjJ0NCs3VnZIMmt0NFk3NFNSdU90RXlO
      R1NuRDVkWTJnNUlTUkEzTjI0Um9IaWhBdHFUVTZBeHBiUDNDSnozY0Y4aTYvclNpcC9sNVZhUlE9
  user: mroberge
  # cleanup was interfering with deployment.
  skip_cleanup: true
  on:
    # Deployment only occurs when all of the following conditions are met:
    
    # 1- when there is a commit to Master
    repo: mroberge/hydrofunctions
    
    # 2- when there is a new version tag (PyPI only accepts uploads with a new version anyway)
    # See line 806 of Build 153.3 to see PyPI reject an upload of a package with the same version number
    # https://travis-ci.org/mroberge/hydrofunctions/jobs/351813494#L806
    tags: true
    
    # 3- when the Python 3.6 environment tests have completed. 
    python: '3.6'
